<div class="mb-5"></div>
<div class="container-fluid">
  <div class="row">
    <div *ngIf="msg" class="alert alert-info d-flex justify-content-center col-12" role="alert">
      {{msg}}
    </div>
    <div class="col-9">
      <table class="table table-striped table-bordered table-sm">
        <caption>Logs table</caption>
        <thead class="p-0">
        <tr>
          <th class="pt-0 pb-0 align-middle" scope="col" style="width: 2%"><input (change)="checkAllCheckBox($event)"
                                                                                  [checked]="isAllCheckBoxChecked()"
                                                                                  type="checkbox"></th>
          <th class="pt-0 pb-0 align-middle" scope="col" style="width: 95%">Text</th>
          <th class="text-center p-0 align-middle" scope="col" style="width: 3%">
            <fa-icon (click)="deleteSelectedLogs()" [icon]="deleteIcon"
                     class="btn h5 pointer-event text-center mb-0 align-middle"></fa-icon>
          </th>
        </tr>
        </thead>
        <tbody>
        <tr
          *ngFor="let log of logPage?.content | paginate: {id: 'logs', itemsPerPage: logPage?.size,currentPage: logPage?.number, totalItems: logPage?.approximate?logPage.size*10:logPage?.totalElements}; let i=index;">
          <td><input [(ngModel)]="logPage?.content[i].checked" type="checkbox" value="{{log.objectId}}"></td>
          <td class="text-monospace">
            <a [innerHTML]="getTextWithDelimiter(log)">
            </a>
            <a *ngIf="log.text.length>155">
              <a (click)="log.fullText=!log.fullText" class="btn btn-link">{{log.fullText ? "less" : "more"}}</a>
            </a>
          </td>
          <td class="text-center">
            <fa-icon (click)="deleteLog(log.objectId)" [icon]="deleteIcon"
                     class="btn fas fa-2x pointer-event"></fa-icon>
          </td>
        </tr>
        </tbody>
      </table>
      <app-pagination-controls (pageChange)="getLogsByRule($event,false)" *ngIf="logPage"
                               [approximate]="logPage?.approximate"
                               id="logs"></app-pagination-controls>
    </div>
    <div class="col-3">Settings
      <hr>
      <form *ngIf="operationForm" [formGroup]="operationForm" class="classForLateralForm">
        <div class="border rounded">
          <div class="m-2">
            <fa-icon [icon]="faSearch"
                     class="fa fa-search"></fa-icon>
            <label class="ml-2" for="searchInput">Search by text</label>
            <input class="form-control" formControlName="text" id="searchInput" name="text" placeholder="Text"
                   [ngClass]="{ 'is-invalid': f.text.errors }" type="text">
            <div *ngIf="f.text.errors" class="invalid-feedback">
              <div *ngIf="f.text.errors.maxLength">This field can't be more than 2000</div>
            </div>
          </div>
        </div>
        <hr>
        <div class="border rounded">
          <div class="m-2">
            <p>
              <fa-icon [icon]="faSortAmountAsc"
                       class="fa fa-sort-amount-asc mr-1"></fa-icon>
              Sorting
            </p>
            <hr>
            <div class="row input-group-sm">
              <label class="col-10" for="sortByLevel">Sort By Level</label>
              <input class="form-control col-2" formControlName="vSort" id="sortByLevel" name="vSort" type="radio"
                     value="1">
            </div>
            <br/>
            <div class="row input-group-sm">
              <label class="col-10" for="sortByDate">Sort By Date</label>
              <input class="form-control  col-2" formControlName="vSort" id="sortByDate" name="vSort" type="radio"
                     value="0">
            </div>
          </div>
        </div>
        <hr>
        <div class="border rounded">
          <div class="m-2">
            <p>
              <fa-icon [icon]="fafilter"
                       class="fa fa-filter mr-1"></fa-icon>
              Filtration
            </p>
            <hr>
            <mat-form-field appearance="legacy">
              <input [(ngModel)]="date1" [ngxMatDatetimePicker]="picker1" class="width-85" formControlName="dat1"
                     id="dat1" matInput name="dat1" placeholder="Start date">
              <mat-icon (click)="clearDate1($event)" matDatepickerToggleIcon>clear</mat-icon>
              <mat-datepicker-toggle [for]="picker1" matSuffix></mat-datepicker-toggle>
              <ngx-mat-datetime-picker #picker1></ngx-mat-datetime-picker>
            </mat-form-field>
            <br/>
            <mat-form-field appearance="legacy">
              <input [(ngModel)]="date2" [ngxMatDatetimePicker]="picker" class="width-85" formControlName="dat2"
                     id="dat2" matInput name="dat2" placeholder="End date">
              <mat-icon (click)="clearDate2($event)" matDatepickerToggleIcon>clear</mat-icon>
              <mat-datepicker-toggle [for]="picker" matSuffix></mat-datepicker-toggle>
              <ngx-mat-datetime-picker #picker></ngx-mat-datetime-picker>
            </mat-form-field>
            <hr>
            <div *ngFor="let key of keys()" class="row mr-1">
              <label [for]="key" class="col-10">{{key}}</label>
              <input [id]="key" class="form-control col-2 mb-1" formControlName="{{key}}" name="logLevel"
                     type="checkbox">
            </div>
          </div>
        </div>
        <hr>
        <button (click)="setNewRule()" class="btn btn-primary" type="submit">Apply</button>
      </form>
    </div>
  </div>
</div>
